{"version":3,"sources":["utils/transformSwapRouteToGetQuoteResult.ts","state/routing/clientSideSmartOrderRouter/dependencies.ts","state/routing/clientSideSmartOrderRouter/index.ts"],"names":["transformSwapRouteToGetQuoteResult","type","amount","quote","quoteGasAdjusted","route","estimatedGasUsed","estimatedGasUsedQuoteToken","estimatedGasUsedUSD","gasPriceWei","methodParameters","blockNumber","routeResponse","subRoute","tokenPath","protocol","Protocol","V3","pools","curRoute","i","length","nextPool","tokenIn","tokenOut","edgeAmountIn","undefined","quotient","toString","edgeAmountOut","push","chainId","decimals","address","symbol","fee","liquidity","sqrtRatioX96","tickCurrent","amountIn","amountOut","V2","pairs","reserve0","reserve1","token","currency","wrapped","amountDecimals","toExact","quoteDecimals","quoteGasAdjustedDecimals","gasUseEstimateQuote","gasUseEstimateQuoteDecimals","gasUseEstimate","gasUseEstimateUSD","routeString","routeAmountsToString","GAMetric","key","value","unit","ReactGA","timing","category","variable","label","IMetric","setGlobalMetric","routerParamsByChain","dependenciesByChain","AUTO_ROUTER_SUPPORTED_CHAINS","provider","providers","JsonRpcProvider","INFURA_NETWORK_URLS","buildDependencies","getQuote","alphaRouterConfig","a","amountRaw","params","Error","router","AlphaRouter","currencyIn","Token","currencyOut","baseCurrency","quoteCurrency","CurrencyAmount","fromRawAmount","JSBI","BigInt","TradeType","EXACT_INPUT","EXACT_OUTPUT","swapRoute","data"],"mappings":"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","file":"static/js/80.41e74f18.chunk.js","sourcesContent":["import { Protocol } from '@uniswap/router-sdk'\nimport { Currency, CurrencyAmount } from '@uniswap/sdk-core'\nimport { routeAmountsToString, SwapRoute } from '@uniswap/smart-order-router'\nimport { GetQuoteResult, V2PoolInRoute, V3PoolInRoute } from 'state/routing/types'\n\n// from routing-api (https://github.com/Uniswap/routing-api/blob/main/lib/handlers/quote/quote.ts#L243-L311)\nexport function transformSwapRouteToGetQuoteResult(\n  type: 'exactIn' | 'exactOut',\n  amount: CurrencyAmount<Currency>,\n  {\n    quote,\n    quoteGasAdjusted,\n    route,\n    estimatedGasUsed,\n    estimatedGasUsedQuoteToken,\n    estimatedGasUsedUSD,\n    gasPriceWei,\n    methodParameters,\n    blockNumber,\n  }: SwapRoute\n): GetQuoteResult {\n  const routeResponse: Array<V3PoolInRoute[] | V2PoolInRoute[]> = []\n\n  for (const subRoute of route) {\n    const { amount, quote, tokenPath } = subRoute\n\n    if (subRoute.protocol === Protocol.V3) {\n      const pools = subRoute.route.pools\n      const curRoute: V3PoolInRoute[] = []\n      for (let i = 0; i < pools.length; i++) {\n        const nextPool = pools[i]\n        const tokenIn = tokenPath[i]\n        const tokenOut = tokenPath[i + 1]\n\n        let edgeAmountIn = undefined\n        if (i === 0) {\n          edgeAmountIn = type === 'exactIn' ? amount.quotient.toString() : quote.quotient.toString()\n        }\n\n        let edgeAmountOut = undefined\n        if (i === pools.length - 1) {\n          edgeAmountOut = type === 'exactIn' ? quote.quotient.toString() : amount.quotient.toString()\n        }\n\n        curRoute.push({\n          type: 'v3-pool',\n          tokenIn: {\n            chainId: tokenIn.chainId,\n            decimals: tokenIn.decimals,\n            address: tokenIn.address,\n            symbol: tokenIn.symbol,\n          },\n          tokenOut: {\n            chainId: tokenOut.chainId,\n            decimals: tokenOut.decimals,\n            address: tokenOut.address,\n            symbol: tokenOut.symbol,\n          },\n          fee: nextPool.fee.toString(),\n          liquidity: nextPool.liquidity.toString(),\n          sqrtRatioX96: nextPool.sqrtRatioX96.toString(),\n          tickCurrent: nextPool.tickCurrent.toString(),\n          amountIn: edgeAmountIn,\n          amountOut: edgeAmountOut,\n        })\n      }\n\n      routeResponse.push(curRoute)\n    } else if (subRoute.protocol === Protocol.V2) {\n      const pools = subRoute.route.pairs\n      const curRoute: V2PoolInRoute[] = []\n      for (let i = 0; i < pools.length; i++) {\n        const nextPool = pools[i]\n        const tokenIn = tokenPath[i]\n        const tokenOut = tokenPath[i + 1]\n\n        let edgeAmountIn = undefined\n        if (i === 0) {\n          edgeAmountIn = type === 'exactIn' ? amount.quotient.toString() : quote.quotient.toString()\n        }\n\n        let edgeAmountOut = undefined\n        if (i === pools.length - 1) {\n          edgeAmountOut = type === 'exactIn' ? quote.quotient.toString() : amount.quotient.toString()\n        }\n\n        const reserve0 = nextPool.reserve0\n        const reserve1 = nextPool.reserve1\n\n        curRoute.push({\n          type: 'v2-pool',\n          tokenIn: {\n            chainId: tokenIn.chainId,\n            decimals: tokenIn.decimals,\n            address: tokenIn.address,\n            symbol: tokenIn.symbol,\n          },\n          tokenOut: {\n            chainId: tokenOut.chainId,\n            decimals: tokenOut.decimals,\n            address: tokenOut.address,\n            symbol: tokenOut.symbol,\n          },\n          reserve0: {\n            token: {\n              chainId: reserve0.currency.wrapped.chainId,\n              decimals: reserve0.currency.wrapped.decimals,\n              address: reserve0.currency.wrapped.address,\n              symbol: reserve0.currency.wrapped.symbol,\n            },\n            quotient: reserve0.quotient.toString(),\n          },\n          reserve1: {\n            token: {\n              chainId: reserve1.currency.wrapped.chainId,\n              decimals: reserve1.currency.wrapped.decimals,\n              address: reserve1.currency.wrapped.address,\n              symbol: reserve1.currency.wrapped.symbol,\n            },\n            quotient: reserve1.quotient.toString(),\n          },\n          amountIn: edgeAmountIn,\n          amountOut: edgeAmountOut,\n        })\n      }\n\n      routeResponse.push(curRoute)\n    }\n  }\n\n  const result: GetQuoteResult = {\n    methodParameters,\n    blockNumber: blockNumber.toString(),\n    amount: amount.quotient.toString(),\n    amountDecimals: amount.toExact(),\n    quote: quote.quotient.toString(),\n    quoteDecimals: quote.toExact(),\n    quoteGasAdjusted: quoteGasAdjusted.quotient.toString(),\n    quoteGasAdjustedDecimals: quoteGasAdjusted.toExact(),\n    gasUseEstimateQuote: estimatedGasUsedQuoteToken.quotient.toString(),\n    gasUseEstimateQuoteDecimals: estimatedGasUsedQuoteToken.toExact(),\n    gasUseEstimate: estimatedGasUsed.toString(),\n    gasUseEstimateUSD: estimatedGasUsedUSD.toExact(),\n    gasPriceWei: gasPriceWei.toString(),\n    route: routeResponse,\n    routeString: routeAmountsToString(route),\n  }\n\n  return result\n}\n","import { AlphaRouterParams, IMetric, MetricLoggerUnit, setGlobalMetric } from '@uniswap/smart-order-router'\nimport { INFURA_NETWORK_URLS } from 'constants/chainInfo'\nimport { SupportedChainId } from 'constants/chains'\nimport { providers } from 'ethers/lib/ethers'\nimport ReactGA from 'react-ga'\n\nimport { AUTO_ROUTER_SUPPORTED_CHAINS } from './constants'\n\nexport type Dependencies = {\n  [chainId in SupportedChainId]?: AlphaRouterParams\n}\n\n/** Minimal set of dependencies for the router to work locally. */\nexport function buildDependencies(): Dependencies {\n  const dependenciesByChain: Dependencies = {}\n  for (const chainId of AUTO_ROUTER_SUPPORTED_CHAINS) {\n    const provider = new providers.JsonRpcProvider(INFURA_NETWORK_URLS[chainId])\n\n    dependenciesByChain[chainId] = {\n      chainId,\n      provider,\n    }\n  }\n\n  return dependenciesByChain\n}\n\nclass GAMetric extends IMetric {\n  putDimensions() {\n    return\n  }\n\n  putMetric(key: string, value: number, unit?: MetricLoggerUnit) {\n    ReactGA.timing({\n      category: 'Routing API',\n      variable: `${key} | ${unit}`,\n      value,\n      label: 'client',\n    })\n  }\n}\n\nsetGlobalMetric(new GAMetric())\n","import { BigintIsh, CurrencyAmount, Token, TradeType } from '@uniswap/sdk-core'\nimport { AlphaRouter, AlphaRouterConfig, ChainId } from '@uniswap/smart-order-router'\nimport JSBI from 'jsbi'\nimport { GetQuoteResult } from 'state/routing/types'\nimport { transformSwapRouteToGetQuoteResult } from 'utils/transformSwapRouteToGetQuoteResult'\n\nimport { buildDependencies } from './dependencies'\n\nconst routerParamsByChain = buildDependencies()\n\nexport async function getQuote(\n  {\n    type,\n    chainId,\n    tokenIn,\n    tokenOut,\n    amount: amountRaw,\n  }: {\n    type: 'exactIn' | 'exactOut'\n    chainId: ChainId\n    tokenIn: { address: string; chainId: number; decimals: number; symbol?: string }\n    tokenOut: { address: string; chainId: number; decimals: number; symbol?: string }\n    amount: BigintIsh\n  },\n  alphaRouterConfig: Partial<AlphaRouterConfig>\n): Promise<{ data: GetQuoteResult; error?: unknown }> {\n  const params = routerParamsByChain[chainId]\n  if (!params) {\n    throw new Error('Router dependencies not initialized.')\n  }\n\n  const router = new AlphaRouter(params)\n\n  const currencyIn = new Token(tokenIn.chainId, tokenIn.address, tokenIn.decimals, tokenIn.symbol)\n  const currencyOut = new Token(tokenOut.chainId, tokenOut.address, tokenOut.decimals, tokenOut.symbol)\n\n  const baseCurrency = type === 'exactIn' ? currencyIn : currencyOut\n  const quoteCurrency = type === 'exactIn' ? currencyOut : currencyIn\n  const amount = CurrencyAmount.fromRawAmount(baseCurrency, JSBI.BigInt(amountRaw))\n\n  const swapRoute = await router.route(\n    amount,\n    quoteCurrency,\n    type === 'exactIn' ? TradeType.EXACT_INPUT : TradeType.EXACT_OUTPUT,\n    /*swapConfig=*/ undefined,\n    alphaRouterConfig\n  )\n\n  if (!swapRoute) throw new Error('Failed to generate client side quote')\n\n  return { data: transformSwapRouteToGetQuoteResult(type, amount, swapRoute) }\n}\n"],"sourceRoot":""}